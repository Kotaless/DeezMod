"use strict";(self.webpackJsonpDeezer=self.webpackJsonpDeezer||[]).push([[2300],{"tU3/":(e,t,n)=>{n.d(t,{A:()=>y}),n("J7II");var s,i,l=n("q1tI"),r=n("TRpf"),a=n("X6oL"),o=n("RGaU"),c=n("HmE0"),h=n("Wp0Y"),p=n("aHAS"),u=n("MbwU"),d=n("Zy2V"),g=n("qPkO"),b=n("puIx"),m=n("Yrjs"),S=n("h6Gj");let w=(0,a.Ay)()(s=class extends l.Component{constructor(e){super(e),this.state={displayMessage:null,unsubscribedChannels:[],userShowOptinList:[],nextShowsIndex:null,loadingShows:!0},this.displayedMessageTimeout=void 0,this.getSelectedOptinsForChannel=e=>this.props.optinList.filter((t=>void 0!==t.channel[e]&&t.channel[e])).length+this.state.userShowOptinList.filter((t=>void 0!==t.channel[e]&&t.channel[e])).length,this.displayMessage=e=>{this.displayedMessageTimeout&&clearTimeout(this.displayedMessageTimeout),this.setState({displayMessage:e}),this.displayedMessageTimeout=setTimeout((()=>{this.setState({displayMessage:null}),this.displayedMessageTimeout=null}),5e3)},this.onOptinValueChange=(e,t)=>{const{unsubscribedChannels:n}=this.state;this.setState({displayMessage:null,unsubscribedChannels:n.filter((e=>e!==t))});const s=this.props.optinList.find((t=>t.name===e));void 0!==s?this.props.toggleOptin(e,t).then((()=>this.displayMessage(!1===s.channel[t]&&void 0!==s.channels_requiring_validation&&s.channels_requiring_validation.includes(t)?b.l.EMAIL_SENT:b.l.OPTIN_UPDATED))).catch((()=>this.displayMessage(b.l.SAVE_FAILED))):this.setState({displayMessage:b.l.SAVE_FAILED})},this.onUnsubscribeAll=(e,t)=>{const{unsubscribedChannels:n}=this.state;n.includes(t)?this.setState({unsubscribedChannels:n.filter((e=>e!==t))}):(this.setState({displayMessage:null,unsubscribedChannels:[...n,t]}),0!==this.getSelectedOptinsForChannel(t)&&this.props.unselectAllOptins(t).then((()=>(0,S.J8)())).then((()=>{this.setState({userShowOptinList:[],nextShowsIndex:null}),this.displayMessage(b.l.OPTIN_UPDATED)})).catch((()=>this.displayMessage(b.l.SAVE_FAILED))))},this.onUserShowOptinValueChange=(e,t,n)=>{const{unsubscribedChannels:s,userShowOptinList:i}=this.state;this.setState({displayMessage:null,unsubscribedChannels:s.filter((e=>e!==t)),userShowOptinList:i.map((s=>(s.id===e&&(s.channel[t]=n),s)))});const l=()=>this.displayMessage(b.l.OPTIN_UPDATED),r=()=>this.displayMessage(b.l.SAVE_FAILED);n?(0,S.r8)(e).then(l).catch(r):(0,S.Xg)(e).then(l).catch(r)},this.onViewMoreShowsClick=()=>{const{nextShowsIndex:e}=this.state;null!==e&&(this.setState({loadingShows:!0}),(0,S.hw)(e,m.fp).then((e=>{this.setState({userShowOptinList:[...this.state.userShowOptinList,...e.userShowOptinList],nextShowsIndex:e.nextShowsIndex,loadingShows:!1})})).catch((()=>this.setState({loadingShows:!1}))),this.props.tracking&&this.props.tracking.trackEvent({event:"click",eventlabel:"podcast",eventaction:"view-more",eventcategory:"notification-preferences_notifications"}))},this.renderUnsubscribeAllGroup=()=>{const{displayChannelHeader:e}=this.props,{unsubscribedChannels:t}=this.state,n=this.channelList,s={name:"unsubscribe_all",label:(0,h.AP)("optinpreferences_text_unsubscribealldzremails_web"),description:(0,h.AP)("optinpreferences_text_inclmusicrlsespodcastslistendata_web"),group:"unsubscribe_all",channel:Object.fromEntries(n.map((e=>[e.name,t.includes(e.name)])))};return l.createElement(u.A,{key:"grp-all",group:{name:"unsubscribe_all",label:(0,h.AP)("optinpreferences_title_unsubscribeall_web"),description:""},optinList:[s],channelList:n,onOptinValueChange:this.onUnsubscribeAll,displayChannelHeader:e})},this.displayedMessageTimeout=null}componentDidMount(){this.displayShows&&(0,S.hw)(0,m.fp).then((e=>{this.setState({...e,loadingShows:!1}),this.props.tracking&&this.props.tracking.trackEvent({event:"onDisplay",eventvalue:e.userShowOptinList.length,eventlabel:"podcast",eventaction:"list-display",eventcategory:"notification-preferences_notifications"})})).catch((()=>this.setState({loadingShows:!1})))}componentWillUnmount(){this.displayedMessageTimeout&&clearTimeout(this.displayedMessageTimeout)}get channelList(){const{channelList:e,channelFilter:t}=this.props;return void 0===t?e:e.filter((e=>t.includes(e.name)))}get displayShows(){return-1!==this.channelList.findIndex((e=>e.name===m.Tn))}renderShowOptinGroup(){const{userShowOptinList:e,nextShowsIndex:t,loadingShows:n}=this.state,s=this.channelList;return l.createElement(l.Fragment,null,e.length?l.createElement(d.A,{userShowOptinList:e,channelList:s,onUserShowOptinValueChange:this.onUserShowOptinValueChange}):null,n?i||(i=l.createElement(o.k,null)):null,n||null===t?null:l.createElement(c.$n,{onClick:this.onViewMoreShowsClick,size:"small",variant:"outline","data-testid":"show-more-btn"},(0,h.AP)("Plus")))}render(){const{displayMessage:e}=this.state,{optinList:t,groupList:n,displayChannelHeader:s,displayUnsubscribeAllFooter:i}=this.props,r=this.channelList;return 0===r.length||0===t.length||0===n.length?null:l.createElement(l.Fragment,null,n.map((e=>l.createElement(l.Fragment,{key:`grp-${e.name}`},l.createElement(u.A,{key:`grp-${e.name}`,group:e,optinList:t.filter((t=>t.group===e.name)),channelList:r,onOptinValueChange:this.onOptinValueChange,displayChannelHeader:s},e.name===m.ko&&this.displayShows?this.renderShowOptinGroup():null)))),i?this.renderUnsubscribeAllGroup():null,null!==e?l.createElement(g.A,{messageType:e}):null)}})||s;const y=(0,r.Ng)((e=>({channelList:e.user.USER.OPTINS.channel,groupList:e.user.USER.OPTINS.group,optinList:e.user.USER.OPTINS.optin})),{toggleOptin:p.XD,unselectAllOptins:p.Cn})(w)},ZATE:(e,t,n)=>{n.r(t),n.d(t,{default:()=>O});var s=n("q1tI"),i=n("TRpf"),l=n("Wp0Y"),r=n("TqF5"),a=n("jKJc"),o=n("DdAs"),c=n("nKUr"),h=n("NSet"),p=n("IXMZ");function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const g={"&::-webkit-scrollbar":{width:"4px",height:"4px"},"&::-webkit-scrollbar-track":{width:"6px"},"&::-webkit-scrollbar-thumb":{bg:"divider.main"},"&::-webkit-scrollbar-corner":{bg:"inherit"}},b=(0,p.Rf)(((e,t)=>(0,c.jsx)(h.so,function(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n.push.apply(n,s)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},s=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(s=s.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),s.forEach((function(t){u(e,t,n[t])}))}return e}({ref:t,overflow:"auto"},e),{sx:g}))));var m=n("HmE0"),S=n("tU3/");const w="optin_mail";class y extends s.Component{constructor(...e){super(...e),this.renderBody=()=>{const{optinList:e,groupList:t,channelList:n}=this.props;return 0===e.length||0===t.length||-1===n.findIndex((e=>e.name===w))?s.createElement("div",{className:"modal-gdpr-intro"},(0,l.AP)("404errorpage_text_somethingwentwrongtwiththispage_web")):s.createElement(S.A,{channelFilter:[w],displayChannelHeader:!1,displayUnsubscribeAllFooter:!0})}}render(){return s.createElement(s.Fragment,null,s.createElement(a.s_,{onClick:this.props.closeModal}),s.createElement(o.rQ,{mt:"spacing.l"},(0,l.AP)("optinpreferences_text_wantobenotifbyemailabout_web")),s.createElement(o.cw,null,s.createElement(b,{maxH:500,flex:1,flexDirection:"column"},this.renderBody())),s.createElement(a.jl,null,s.createElement(h.Tk,null,s.createElement(m.$n,{className:"actions-button",onClick:this.props.closeModal},(0,l.AP)("Fermer")))))}}const O=(0,i.Ng)((e=>({channelList:e.user.USER.OPTINS.channel,groupList:e.user.USER.OPTINS.group,optinList:e.user.USER.OPTINS.optin})),{closeModal:r.Oo})(y)},"YeG+":(e,t,n)=>{var s=n("S4+I"),i=n("iAz1"),l=n("2c1O");e.exports=function(e,t,n){s?i.f(e,t,l(0,n)):e[t]=n}},J7II:(e,t,n)=>{var s=n("iX0t"),i=n("cO21"),l=n("YeG+");s({target:"Object",stat:!0},{fromEntries:function(e){var t={};return i(e,(function(e,n){l(t,e,n)}),{AS_ENTRIES:!0}),t}})}}]);