"use strict";(self.webpackJsonpDeezer=self.webpackJsonpDeezer||[]).push([[9700],{ki90:(e,t,n)=>{n.r(t),n.d(t,{default:()=>f}),n("aRRr");var s,i=n("lXQd"),a=n("q1tI"),l=n("X6oL");const o=({channel:e,onClick:t})=>a.createElement("button",{className:"notifications-btn",onClick:()=>t(e.name),type:"button"},e.label,s||(s=a.createElement("svg",{className:"svg-icon svg-icon-chevron-right",height:"12",viewBox:"0 0 12 12",width:"12"},a.createElement("g",null,a.createElement("path",{d:"M7.3,6,2.8,10.4a.9.9,0,0,0,0,1.3.8.8,0,0,0,1.3,0L9.3,6.6a.9.9,0,0,0,0-1.2L4.1.3A.9.9,0,0,0,2.8.3a.9.9,0,0,0,0,1.3Z"})))));var S,E,y,r=n("MbwU"),h=n("qPkO"),c=n("Zy2V"),p=n("RGaU"),d=n("HmE0"),u=n("LjZa"),g=n("Wp0Y"),m=n("juqV"),w=n("puIx"),v=n("Yrjs"),L=n("nrKQ"),A=n("h6Gj");const f=(0,l.Ay)()(S=class extends a.Component{constructor(e){super(e),this.state={loading:!0,channelList:[],groupList:[],optinList:[],selectedChannelIndex:0,displayMessage:null,showList:[],nextShowsIndex:null,loadingShows:!1},this.displayedMessageTimeout=void 0,this.onChannelChange=e=>{const t=this.state.channelList.findIndex((t=>t.name===e));if(-1!==t&&(this.setState({selectedChannelIndex:t}),this.props.tracking)){let t="notification-preferences_sms";"optin_push"===e?t="notification-preferences_notifications":"optin_mail"===e&&(t="notification-preferences_email"),this.props.tracking.trackEvent({event:"click",eventaction:"open-channel",eventcategory:t})}},this.displayMessage=e=>{this.displayedMessageTimeout&&clearTimeout(this.displayedMessageTimeout),this.setState({displayMessage:e}),this.displayedMessageTimeout=setTimeout((()=>{this.setState({displayMessage:null}),this.displayedMessageTimeout=null}),5e3)},this.onOptinValueChange=(e,t,n)=>{const s=[...this.state.optinList],i=s.find((t=>t.name===e)),a=this.state.selectedChannelIndex;if(void 0===i||void 0===this.state.channelList[a]||this.state.channelList[a].name!==t)return;const l=this.state.channelList[a].name;void 0!==i.channel[l]&&(i.channel[l]=n,this.setState({optinList:s}),((e,t,n,s,i)=>{L.A.call({method:"user.setOptins",data:{SERVICE_NAME:e,OPTIN:[{name:t,channel:n}]},success:s,error:i})})(this.serviceName,i.name,i.channel,(()=>this.displayMessage(n&&void 0!==i.channels_requiring_validation&&i.channels_requiring_validation.includes(l)?w.l.EMAIL_SENT:w.l.OPTIN_UPDATED)),(()=>this.displayMessage(w.l.SAVE_FAILED))))},this.onUserShowOptinValueChange=(e,t,n)=>{const{showList:s}=this.state;this.setState({showList:s.map((s=>(s.id===e&&(s.channel[t]=n),s)))});const i=()=>this.displayMessage(w.l.OPTIN_UPDATED),a=()=>this.displayMessage(w.l.SAVE_FAILED);n?(0,A.r8)(e).then(i).catch(a):(0,A.Xg)(e).then(i).catch(a)},this.onViewMoreShowsClick=()=>{const{showList:e,nextShowsIndex:t}=this.state;null!==t&&(this.setState({loadingShows:!0}),(0,A.hw)(t,v.fp).then((t=>this.setState({showList:[...e,...t.userShowOptinList],nextShowsIndex:t.nextShowsIndex,loadingShows:!1}))).catch((()=>this.setState({loadingShows:!1}))),this.props.tracking&&this.props.tracking.trackEvent({event:"click",eventlabel:"podcast",eventaction:"view-more",eventcategory:"notification-preferences_notifications"}))},this.renderShowGroup=e=>{const{showList:t,nextShowsIndex:n,loadingShows:s,selectedChannelIndex:i}=this.state,l=t.filter((t=>void 0!==t.channel[e.name]));return void 0===this.state.channelList[i]||this.state.channelList[i].name!==v.Tn?null:a.createElement(a.Fragment,null,l.length?a.createElement(c.A,{userShowOptinList:l,channelList:[e],onUserShowOptinValueChange:this.onUserShowOptinValueChange,insideApp:this.insideApp}):null,s?E||(E=a.createElement(p.k,null)):null,s||null===n?null:a.createElement(d.$n,{onClick:this.onViewMoreShowsClick,size:"sm",variant:"outline","data-testid":"show-more-btn"},(0,g.AP)("Plus")))},this.renderGroups=e=>{const{groupList:t,optinList:n}=this.state,s=n.filter((t=>void 0!==t.channel[e.name]));return a.createElement("div",{className:"webview-gdpr-container",key:`channel-${e.name}`},a.createElement("h2",{className:"heading-2"},e.label),a.createElement("p",{className:"description"},e.description),t.map((t=>{const n=s.filter((e=>e.group===t.name));return n.length?a.createElement(a.Fragment,{key:`grp-${t.name}`},a.createElement(r.A,{group:t,optinList:n,onOptinValueChange:this.onOptinValueChange,channelList:[e],displayChannelHeader:!1,isWebview:!0},t.name===v.ko?this.renderShowGroup(e):null)):null})))},this.displayedMessageTimeout=null}componentDidMount(){var e,t,n,s;e=this.serviceName,t=this.displayAll,n=e=>{this.setState({loading:!1,...e}),this.props.tracking&&this.props.tracking.trackEvent({event:"onDisplay",eventvalue:e.showList.length,eventlabel:"podcast",eventaction:"list-display",eventcategory:"notification-preferences_notifications"})},s=u.A,L.A.call({method:"user.getOptins",data:{SERVICE_NAME:e,DISPLAY_ALL:t},success:e=>n({channelList:e.channel,groupList:e.group,optinList:e.optin,showList:e.shows.list.map((e=>({id:e.SHOW_ID,name:e.SHOW_NAME,imageMd5:e.SHOW_ART_MD5,channel:{optin_push:!0}}))),nextShowsIndex:void 0!==e.shows.next_cursor?Number(e.shows.next_cursor):null}),error:s})}componentDidUpdate(e,t){this.state.selectedChannelIndex!==t.selectedChannelIndex&&window.scrollTo(0,0)}componentWillUnmount(){this.displayedMessageTimeout&&clearTimeout(this.displayedMessageTimeout)}get displayAll(){return["true","1"].includes((0,i.A)(this.props,"location.query.all"))}get insideApp(){return["true","1"].includes((0,i.A)(this.props,"location.query.inside_app"))}get insideIOS(){return["true","1"].includes((0,i.A)(this.props,"location.query.ios"))}get serviceName(){return(0,i.A)(this.props,"location.query.service_name","deezer")}render(){const{loading:e,channelList:t,groupList:n,optinList:s,selectedChannelIndex:i,displayMessage:l}=this.state;if(e)return y||(y=a.createElement("div",{className:"webview-gdpr-loader"},a.createElement(p.k,null)));if(0===t.length||0===n.length||0===s.length)return a.createElement("div",null,(0,g.AP)("404errorpage_text_somethingwentwrongtwiththispage_web"));const r=["webview-gdpr"],c=["webview-gdpr-footer"];return this.insideApp&&this.insideIOS&&(r.push("webview-gdpr--ios"),c.push("webview-gdpr-footer--ios")),"deezer"!==this.serviceName&&r.push(`webview-gdpr--${this.serviceName}`),a.createElement("div",{id:"webview-gdpr",className:(0,m.A)(r)},t.map(((e,t)=>t===i?this.renderGroups(e):a.createElement(o,{key:`btn-${e.name}`,channel:e,onClick:this.onChannelChange}))),a.createElement("footer",{className:(0,m.A)(c)},null!==l?a.createElement(h.A,{messageType:l}):null))}})||S}}]);